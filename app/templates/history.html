{% extends "base.html" %}

{% block title %}{{ _('Historial') }}{% endblock %}

{% block content %}
<div class="glass-panel" style="padding: 2rem;">
    <h1>{{ _('Historial de Transacciones') }}</h1>

    <div class="table-container">
        <table id="history-table">
            <thead>
                <tr>
                    <th>{{ _('Fecha') }}</th>
                    <th>{{ _('Total') }}</th>
                    <th>{{ _('Recibido') }}</th>
                    <th>{{ _('Cambio') }}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="4" class="text-center">{{ _('Cargando...') }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const tbody = document.querySelector('#history-table tbody');
        try {
            const response = await fetch('/api/history');
            const data = await response.json();

            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">{{ _("No hay registros") }}</td></tr>';
                return;
            }

            data.forEach(row => {
                const tr = document.createElement('tr');
                const date = new Date(row.timestamp).toLocaleString();
                tr.innerHTML = `
                <td>${date}</td>
                <td>€ ${row.total.toFixed(2)}</td>
                <td>€ ${row.received.toFixed(2)}</td>
                <td style="font-weight: bold; color: var(--primary);">€ ${row.change.toFixed(2)}</td>
            `;
                tbody.appendChild(tr);
            });
        } catch (err) {
            console.error(err);
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">{{ _("Error al cargar historial") }}</td></tr>';
        }
    });
</script>
{% endblock %}